# HN Rerank

> A personalized, privacy-first Hacker News dashboard that learns from your upvotes.

HN Rerank fetches stories from the last 30 days and re-ranks them based on semantic similarity to your Hacker News history (upvoted/favorited stories). It runs entirely locally using ONNX modelsâ€”no data ever leaves your machine.

## Features

- **Multi-Interest Clustering**: Automatically discovers your interest clusters from upvote history using Agglomerative Clustering. Cluster names are generated by a local LLM (ollama).
- **Per-Story Cluster Tags**: Each recommended story shows which of your interest clusters it matches.
- **Story TL;DRs**: LLM-generated summaries (up to 800 chars) covering the story and key discussion points, replacing the raw comments view.
- **Personalized Ranking**: Uses local BGE-base embeddings to find stories matching your specific interests.
- **MMR Diversity**: Maximal Marginal Relevance prevents showing 30 stories on the same topic.
- **Privacy-First**: Your credentials and history stay in `.cache/`. No third-party AI APIs.

## Quick Start

1. **Install Dependencies** (requires `uv`):
   ```bash
   uv sync
   ```

2. **Setup Model**:
   ```bash
   uv run setup_model.py
   ```

3. **Generate Dashboard**:
   ```bash
   uv run generate_html.py <your-hn-username>
   ```
   Outputs:
   - `index.html` - Ranked story recommendations with cluster tags and TL;DRs
   - `clusters.html` - Detailed interest cluster visualization

## How It Works

1. **Profile Building**: Fetches your upvoted stories from HN (requires login)
2. **Clustering**: Groups your upvotes into interest clusters (e.g., "ML/AI", "Rust", "Startups")
3. **Candidate Fetching**: Gets recent popular stories from Algolia
4. **Ranking**: Scores candidates by similarity to your interest clusters
5. **Diversity**: Applies MMR to ensure variety in recommendations

## Configuration

Key parameters in `api/constants.py`:
- `MAX_USER_STORIES`: Number of upvotes to analyze (default: 1000)
- `CANDIDATE_FETCH_COUNT`: Stories to consider (default: 200)
- `ALGOLIA_DEFAULT_DAYS`: Time window for candidates (default: 30)
- `MIN_CLUSTERS` / `MAX_CLUSTERS`: Clustering bounds (2-50)

## Documentation

- [**ARCHITECTURE.md**](ARCHITECTURE.md): Deep dive into the scoring algorithms, clustering, and data flow.
- [**TECHNICAL_DEBT.md**](TECHNICAL_DEBT.md): Security audit, performance notes, and future roadmap.

## Development

```bash
# Run tests
uv run pytest

# Run with coverage
uv run pytest --cov=api

# Lint
uv run ruff check .

# Type check
ty check
```
